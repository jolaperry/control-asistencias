<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario - {{ mes }} {{ anio }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <h1>Asistencias - {{ mes }} {{ anio }}</h1>
        <nav>
            <a href="{{ url_for('admin_view') }}" class="back-button">Volver a Administración</a>
        </nav>
    </header>

    <main>
        <div class="selection-container">
            <form id="month-form">
                <label for="mes">Mes:</label>
                <select id="mes" name="mes">
                    {% for m in meses %}
                    <option value="{{ m.numero }}" {% if m.numero == mes_numero %}selected{% endif %}>{{ m.nombre }}</option>
                    {% endfor %}
                </select>
                <label for="anio">Año:</label>
                <input type="number" id="anio" name="anio" value="{{ anio }}" min="2020" max="2050">
            </form>
        </div>
        
        <div id="calendar-table-container">
            {{ rendered_calendar|safe }}
        </div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const monthForm = document.getElementById('month-form');
            const mesSelect = document.getElementById('mes');
            const anioInput = document.getElementById('anio');
            const calendarContainer = document.getElementById('calendar-table-container');

            function updateCalendar() {
                const anio = anioInput.value;
                const mes = mesSelect.value;
                
                // Hace la solicitud AJAX
                fetch(`/calendario/${anio}/${mes}`, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.text())
                .then(html => {
                    // Reemplaza el contenido del contenedor con el nuevo HTML
                    calendarContainer.innerHTML = html;
                })
                .catch(error => console.error('Error al actualizar el calendario:', error));
            }

            mesSelect.addEventListener('change', updateCalendar);
            anioInput.addEventListener('change', updateCalendar);
        });
    </script>
</body>
</html>
